name: Terraform1

on:
  workflow_dispatch:
  
env:
  BUCKET: test-lambda-bucket-1999
  TFSTATE_FILE: amancloudeq.tfstate


jobs:
  terraform:
    name: TeraFORM
    runs-on: ubuntu-latest

    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
              

    - name: setup terraform
      uses: hashicorp/setup-terraform@v1
#     - name: Go to example folder
#       run : |
#               cd "example/" 
              
    - name: Configure AWS Crendentials
      uses: aws-actions/configure-aws-credentials@master
      with :
        aws-access-key-id: ${{secrets.aws-access-key-id}} 
        aws_secret_access_key_id: ${{secrets.aws_secret_access_key_id}}
        aws_session_token: ${{secrets.aws_session_token}}
        aws-region : us-west-1
          

    - name: terraform init

      id: init

      run: |

          cd example

          terraform init -reconfigure -backend-config="bucket=$BUCKET" -backend-config="key=$TFSTATE_FILE" 

    - name: Terraform Validate

      id: validate

      run: |

          cd example

          terraform validate -no-color

    - name: Terraform Plan

      id: plan

      run: |

          cd example

          terraform plan -no-color

     

    - name: Terraform Apply

      run: |

          cd example

          terraform apply -auto-approve
